---
title: "Data Analysis of the NOAA Storm Data set to determine Weather Event's Economic and Public Health consequences"
author: "Allan R. Brewer Cappellin"
date: "April, 25th 2015"
output: 
  html_document:
    keep_md: true
    toc: true
    toc_depth: 3
---

## Synopsis

This research is aimed to determine the consequence of different weather events on economical and public health across the United States. The data was obtained from a link in the course Reproducible Research in the Coursera Data Science Specialization. Originally this data comes from the NOAA Storm Database. This analysis will determine the consequences by Event Type. The public health consequences will be measured by fatalities and injuries. The economical consequences will be measured by cost of by property and crop damage.

## Downloading Data and Loading Packages

Data downloaded from the the web from this URL [Storm DataSet](https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2).

```{r Download_Dataset, echo=TRUE, eval=FALSE}
download.file(url = "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2", destfile = "./NOAA_StormData.csv.bz2")
```

### Loading Required Packages

Before loading the data to R and process the data set we must load/install the required packages for the Analysis.

```{r Require_Packages, echo=TRUE, message=FALSE, warning=FALSE}
if (!require(dplyr)) { install.packages("dplyr") }
if (!require(ggplot2)) { install.packages("ggplot2") }
```

### Load Data into R

After loading the packages we load the data set to the Environment to star the analysis.

```{r Load_Data, echo=TRUE}
stormdata <- read.csv("~/Desktop/NOAA_StormData.csv", stringsAsFactors = FALSE)
stormdata <- tbl_df(stormdata)
```

## Processing the Data

After loading the data and the packages into R we can star processing the data to do the analysis. The first thing we should do is print out the summary/structure of the data set to understand the variables contained in it.

```{r, echo=TRUE}
str(stormdata)
```

From this summary and the [Storm Data Documentation](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf) we can detect the variables that will work for our analysis. The variables are:

- **EVTYPE:** this variable indicates the type of event.
- **FATALITIES:** this variables indicates the fatalities in the event.
- **INJURIES:** this variables indicates the injuries in the event.
- **PROPDMG:** this variables indicates the value of property damage in the event
- **PROPDMGEXP:** this variables indicates the exponent associated with the property damage Value
- **CROPDMG:** this variables indicates the value of crop damage in the event
- **CROPDMGEXP:** this variables indicates the exponent associated with the crop damage Value

Since the other variables in the data set are not used in the entire analysis we can subset the data to contain only the variables we need. We will use the dplyr package previously loaded for this step. After we will group the activity by Event Type to so we can do the data analysis. Finally in this step we print the first rows of the subset and grouped data.

```{r, echo=TRUE}
stormdata <- select(stormdata, EVTYPE, FATALITIES, INJURIES, PROPDMG, PROPDMGEXP, CROPDMG, CROPDMGEXP)
stormdata <- group_by(stormdata, EVTYPE)
stormdata
```

This subset of data is what we will use for the analysis. First we have to check the EVTYPE variable to see if it is correctly defined and if all events are unified.

```{r, echo=TRUE}
events <- unique(stormdata$EVTYPE)
events
```
After inspecting the EVTYPE variable we must do some changes to the Variable so the analysis we will do is accurate.

```{r, echo=TRUE}
## All Event Types to capital Letters
stormdata$EVTYPE <- toupper(stormdata$EVTYPE)
## Remove all "Summary" Events from the data set
stormdata <- stormdata[!grepl("^SUMMARY", stormdata$EVTYPE), ]
## Eliminate multiple spaces at the start, the middle, or end of the Event name
stormdata$EVTYPE <- gsub("^ +", "", stormdata$EVTYPE)
stormdata$EVTYPE <- gsub("$ +", "", stormdata$EVTYPE)
stormdata$EVTYPE <- gsub(" +", " ", stormdata$EVTYPE)
## Unite all Thunderstorms events
stormdata[grepl("THUNDERSTORM", stormdata$EVTYPE), ]$EVTYPE <- "THUNDERSTORM"
stormdata[grepl("TSTM", stormdata$EVTYPE), ]$EVTYPE <- "THUNDERSTORM"
## Unite all Tornado events
stormdata[grepl("TORNADO", stormdata$EVTYPE), ]$EVTYPE <- "TORNADO"
## Unite all Wind events
stormdata[grepl("WIND", stormdata$EVTYPE), ]$EVTYPE <- "WIND"
## Unite all Heat/Dry events
stormdata[grepl("HEAT", stormdata$EVTYPE), ]$EVTYPE <- "HEAT"
stormdata[grepl("HOT", stormdata$EVTYPE), ]$EVTYPE <- "HEAT"
stormdata[grepl("HIGH TEMP", stormdata$EVTYPE), ]$EVTYPE <- "HEAT"
stormdata[grepl("WARM", stormdata$EVTYPE), ]$EVTYPE <- "HEAT"
stormdata[grepl("DRY", stormdata$EVTYPE), ]$EVTYPE <- "DRY"
## Unite all Wet events
stormdata[grepl("WET", stormdata$EVTYPE), ]$EVTYPE <- "WET"
## Unite all Snow/Ice/Cold events
stormdata[grepl("BLIZZARD", stormdata$EVTYPE), ]$EVTYPE <- "BLIZZARD"
stormdata[grepl("SNOW", stormdata$EVTYPE), ]$EVTYPE <- "SNOW"
stormdata[grepl("ICE", stormdata$EVTYPE), ]$EVTYPE <- "ICE"
stormdata[grepl("COLD", stormdata$EVTYPE), ]$EVTYPE <- "COLD"
stormdata[grepl("LOW TEMP", stormdata$EVTYPE), ]$EVTYPE <- "COLD"
stormdata[grepl("COOL", stormdata$EVTYPE), ]$EVTYPE <- "COOL"
stormdata[grepl("FREEZ", stormdata$EVTYPE), ]$EVTYPE <- "FREEZ"
stormdata[grepl("WINTER", stormdata$EVTYPE), ]$EVTYPE <- "WINTER WEATHER"
## Unite all Volcano events
stormdata[grepl("VOLCAN", stormdata$EVTYPE), ]$EVTYPE <- "VOLCANO"
## Unite all Flood events
stormdata[grepl("FLOOD", stormdata$EVTYPE), ]$EVTYPE <- "FLOOD"
## Unite all Rain/Hail events
stormdata[grepl("RAIN", stormdata$EVTYPE), ]$EVTYPE <- "RAIN"
stormdata[grepl("SHOWER", stormdata$EVTYPE), ]$EVTYPE <- "RAIN"
stormdata[grepl("PRECIP", stormdata$EVTYPE), ]$EVTYPE <- "RAIN"
stormdata[grepl("HAIL", stormdata$EVTYPE), ]$EVTYPE <- "HAIL"
## Unite all Lightning events
stormdata[grepl("LIGHTNING", stormdata$EVTYPE), ]$EVTYPE <- "LIGHTNING"
## Unite all Hurricane/Typhoon events
stormdata[grepl("HURRICANE", stormdata$EVTYPE), ]$EVTYPE <- "HURRICANE/TYPHOON"
stormdata[grepl("TYPHOON", stormdata$EVTYPE), ]$EVTYPE <- "HURRICANE/TYPHOON"
## Unite all Tropical Storm events
stormdata[grepl("TROPICAL", stormdata$EVTYPE), ]$EVTYPE <- "TROPICAL STORM"
## Unite all Surf events
stormdata[grepl("SURF", stormdata$EVTYPE), ]$EVTYPE <- "SURF"
stormdata[grepl("WAVE", stormdata$EVTYPE), ]$EVTYPE <- "SURF"
## Unite all Tidal events
stormdata[grepl("TIDE", stormdata$EVTYPE), ]$EVTYPE <- "TIDE"
## Unite all Fire/Smoke events
stormdata[grepl("FIRE", stormdata$EVTYPE), ]$EVTYPE <- "FIRE"
stormdata[grepl("SMOKE", stormdata$EVTYPE), ]$EVTYPE <- "SMOKE"
## Unite all Dust events
stormdata[grepl("DUST", stormdata$EVTYPE), ]$EVTYPE <- "DUST"
## Unite all Fog events
stormdata[grepl("FOG", stormdata$EVTYPE), ]$EVTYPE <- "FOG"
```
After my best effort to consolidate all event types into correctly spelled and into same types it was not possible to do a perfect job. But a great part of the events where reduces into one corresponding type. Now the next step in processing the data is to transform the Damage Variables into the correct units applying the Exponents from the DMGEXP Variable.

We first print the unique values for this variable to see its content

```{r, echo=TRUE}
## Symbols for the Property Damage Variable
propexpo <- unique(stormdata$PROPDMGEXP)
expo
## Symbols for the Crop Damage Variable
cropexpo <- unique(stormdata$CROPDMGEXP)
expo
```

We can determine from the Storm Data set documentation that the conversions are as follows:

- +/-/? = 0
- 1 = 1*10^1
- 2 = 1*10^2
- 3 = 1*10^3
- 4 = 1*10^4
- 5 = 1*10^5
- 6 = 1*10^6
- 7 = 1*10^7
- 8 = 1*10^8
- H/h = 100
- K/k = 1000
- M/m = 1000000
- B/b = 1000000000

```{r, echo=TRUE}
## Change the PROPDMGEXP Symbols into numbers
stormdata$PROPDMGEXP <- gsub("\\+|\\-|\\?", "0", stormdata$PROPDMGEXP)
stormdata$PROPDMGEXP <- gsub("1", "10", stormdata$PROPDMGEXP)
stormdata$PROPDMGEXP <- gsub("2", "100", stormdata$PROPDMGEXP)
stormdata$PROPDMGEXP <- gsub("3", "1000", stormdata$PROPDMGEXP)
stormdata$PROPDMGEXP <- gsub("4", "10000", stormdata$PROPDMGEXP)
stormdata$PROPDMGEXP <- gsub("5", "100000", stormdata$PROPDMGEXP)
stormdata$PROPDMGEXP <- gsub("6", "1000000", stormdata$PROPDMGEXP)
stormdata$PROPDMGEXP <- gsub("7", "10000000", stormdata$PROPDMGEXP)
stormdata$PROPDMGEXP <- gsub("8", "100000000", stormdata$PROPDMGEXP)
stormdata$PROPDMGEXP <- gsub("H|h", "100", stormdata$PROPDMGEXP)
stormdata$PROPDMGEXP <- gsub("K|k", "1000", stormdata$PROPDMGEXP)
stormdata$PROPDMGEXP <- gsub("M|m", "1000000", stormdata$PROPDMGEXP)
stormdata$PROPDMGEXP <- gsub("B|b", "1000000000", stormdata$PROPDMGEXP)
stormdata$PROPDMGEXP <- as.numeric(stormdata$PROPDMGEXP)
stormdata$PROPDMGEXP[is.na(stormdata$PROPDMGEXP)] = 0

## Change the CROPDMGEXP Symbols into numbers
stormdata$CROPDMGEXP <- gsub("\\+|\\-|\\?", "0", stormdata$CROPDMGEXP)
stormdata$CROPDMGEXP <- gsub("1", "10", stormdata$CROPDMGEXP)
stormdata$CROPDMGEXP <- gsub("2", "100", stormdata$CROPDMGEXP)
stormdata$CROPDMGEXP <- gsub("3", "1000", stormdata$CROPDMGEXP)
stormdata$CROPDMGEXP <- gsub("4", "10000", stormdata$CROPDMGEXP)
stormdata$CROPDMGEXP <- gsub("5", "100000", stormdata$CROPDMGEXP)
stormdata$CROPDMGEXP <- gsub("6", "1000000", stormdata$CROPDMGEXP)
stormdata$CROPDMGEXP <- gsub("7", "10000000", stormdata$CROPDMGEXP)
stormdata$CROPDMGEXP <- gsub("8", "100000000", stormdata$CROPDMGEXP)
stormdata$CROPDMGEXP <- gsub("H|h", "100", stormdata$CROPDMGEXP)
stormdata$CROPDMGEXP <- gsub("K|k", "1000", stormdata$CROPDMGEXP)
stormdata$CROPDMGEXP <- gsub("M|m", "1000000", stormdata$CROPDMGEXP)
stormdata$CROPDMGEXP <- gsub("B|b", "1000000000", stormdata$CROPDMGEXP)
stormdata$CROPDMGEXP <- as.numeric(stormdata$CROPDMGEXP)
stormdata$CROPDMGEXP[is.na(stormdata$CROPDMGEXP)] = 0
```

